知的好奇心からyoutubeのシステムがどのように構築されているか気になったために

自分で動画配信システムを開発してみることにしました。

完全に学習目的で実践しているため

・UIデザインはほぼ本家を踏襲していること

・とりあえず動作させることを優先する

・大量のアクセスを想定していない（インフラ面は今回はほとんど考慮していません）

上記を前提としていることを念頭に入れていただければと思います。　　




【技術スタック】

フロントエンド：Next.js(App router)

バックエンド:  APIroute,Express

データベース: supabase(postgreSQL)

認証: supabaseAuth又はNextAuthを使用予定

状態管理ライブラリ: 今回はJyotaiを採用しています。

ORM：　prismaを使用

ホスティング(予定): AWSにデプロイ予定



【設計方針】


可能な限りサーバーコンポーネント内でデータフェッチをするように意識する。

データの操作はPrismaを使ってシンプルにする。

なるべくコンポーネントを切り分けて管理をしやすくする。


【学んだ技術】


・Websocket

リアルタイム処理に使用（ライブコメントの送受信、サーバーからランダムにメッセージをクライアントに送信するなど）

今回は少数ユーザーのみが使用することを前提としているため特にインフラの構築はしていません。

もし大量のユーザーからアクセスがあり負荷分散することが必要となれば、

Redisを利用して複数のサーバー同士がデータの共有ができる構成に変える必要があります。




・hls.js

ライブストリーミングを実装するために使用。

今回はexpressがフロントエンドからリクエストされたm3u8ファイルが存在するかを確認して、

存在すればそのm3u8ファイルをレスポンスしてhls.jsに渡し

ライブストリーミングを再生するようにしました。

他に有力な実装方法として

WebサーバーにNginxを採用する方法もあります。（こちらのほうが簡単かもしれません）

ちなみにですが、ライブストリーミングに必須であるm3u8ファイルの生成は

ffmpegを使用しました。

実案件の場合だと、ライブ配信を開始したら

ffmpegを実行、生成される大量のファイルの管理（データベースに保存してから削除など）を行うシェルなどが

必要になりそうです。



・stripe決済

スーパーチャット機能を実装するために使用。

APIを利用することでシンプルに決済機能を実装できました。

今回は簡単な決済機能を導入することが目的であったため複雑なカスタマイズはしていませんが、

既存ユーザーであれば2回目以降のクレジットカード情報の入力を不要にするといったことも実現できるようです。

















